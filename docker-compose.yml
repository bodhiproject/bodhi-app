version: '3.4'
services:
  sync:
    build: sync/.
    depends_on:
      - mongo
      - qtumd
    ports:
      - 5555:5555
    command: ["./wait-for-it.sh", "mongo:27017", "qtumd:13889", "--", "node", "index.js"]

  mongo:
    image: mongo:3.6.0
    environment:
      - MONGO_DATA_DIR=/data/db
      - MONGO_LOG_DIR=/dev/null
    volumes:
      - ./data/db:/data/db
    command: mongod --smallfiles --logpath=/dev/null # --quiet

  qtumd:
    image: qtum/qtum:0.14.12
    volumes:
      - ./data/qtum:/root/.qtum
    ports:
      - 5554:13889
    command: bash -c "qtumd -rpcuser=bodhi -rpcpassword=bodhi -testnet -rpcallowip=::/24 -logevents"

  api:
    build: api/.
    depends_on:
      - qtumd
    ports:
      - 5556:8080
    command: ["./wait-for-it.sh", "qtumd:13889", "--", "npm", "start"]

  ui:
    build: ui/.
    depends_on:
      - sync
      - api
    ports:
      - 5557:5000
    command: ["./wait-for-it.sh", "sync:5555", "api:8080", "--", "serve", " -s build"]

